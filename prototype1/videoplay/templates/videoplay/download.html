{% extends "videoplay/base.html"%}
{% load static %}
{% block content %}
<script src="{% static 'videoplay/jszip.js' %}" type="text/javascript"></script>
<script src="{% static 'videoplay/FileSaver.js' %}" type="text/javascript"></script>
<script>
  
  var objs = '{{urls}}'.split(',');
  //var zip = new JSZip();
  //var count = 0;
  //var zipFilename = "zipFilename.zip";
  /*function clickdownload(){
    var interval = setInterval(ondownload, 300,objs);
    if (objs.length == 0) {
        clearInterval(interval);
        return;
      }
  }
 
  function ondownload(objs){
      if (objs.length == 0) {
        return;
      }
      
      var url = objs.pop();
      console.log(url)
 
      var a = document.createElement("a");
      a.setAttribute('href',  url);
      a.setAttribute('download', '');
      a.setAttribute('target', '_blank');
      a.click();
     }*/
     
     
function createZip()
{     /*console.log("inside function create zip");
var zip = new JSZip();
      var a = document.querySelector("a");
     

      function request(url) {
        return new Promise(function(resolve) {
          var httpRequest = new XMLHttpRequest();
          httpRequest.open("GET", url);
          httpRequest.onload = function() {
            zip.file(url, this.responseText);
            resolve()
          }
          httpRequest.send()
        })
      }

      Promise.all(objs.map(function(url) {
          return request(url)
        }))
        .then(function() {
          console.log(zip);
          zip.generateAsync({
              type: "blob"
          })
          .then(function(content) {
            a.download = "folder" + new Date().getTime();
            a.href = URL.createObjectURL(content);
            a.innerHTML = "download " + a.download;
          });
        })*/
        var zip = new JSZip();

// Add an top-level, arbitrary text file with contents
//zip.file("Hello.txt", "Hello World\n");

// Generate a directory within the Zip file structure
var video = zip.folder("videos");

// Add a file to the directory, in this case an image with data URI as contents
for(var i =0;i<objs.length;i++)
{
  var f = objs[i];

  video.file(f, data, {binary:true});
  console.log(f);
  console.log(video);
}

// Generate the zip file asynchronously
zip.generateAsync({type:"blob"})
.then(function(content) {
    // Force down of the Zip file
    saveAs(content, "videos.zip");
});
        
}
</script>

<div class="container fluid">
                            <div class="row">
                              <div class="col text-center">
                                <div class="jumbotron">
                                    <h1 class="display-4">Welcome!</h1>
                                    <p class="lead">Thank you for your participation!</p>
                                    <hr class="my-4 text-center">
                                    <div class="list-group text-left">
                                    <ol>
                                    <li> As Step one download the videos using download button given below</li>
                                    <li>Once Videos are Downloaded click "Start Watching" and provide the location to the downloaded videos by clicking the "Select Videos" button on the next page</li>
                                    <li>The Study comprises in total of 20 Videos,Pause the video at any moment you want to take a break.</li>
                                    <li>At the end of each video enter your rating from scale of 1-10</li>
                                    <li>Study will end only when ratings are given to all the videos</li>

                                   </ol>
                                
                                 </div>
                                    {% if user.is_authenticated %}
   
                                       

                                        <button type="button" class="btn btn-success btn-md" onclick ="createZip()">Download Your Personalized Videos for the Ratings</button>


                                        <br/>
                                        <br/>
                                          <br/>

                                            <br/>
                                          <a href="{% url 'videoplay-videos' %}"><button type="button" class="btn btn-danger btn-md">Start Watching</button></a>
                                          


                                    {% else %}
                                      <div>
                                          <b>Need an Account?  </b>
                                          <p></p>
                                          <a  class="btn btn-primary btn-md" href="{%url 'register'%}" role="button">Sign Up!</a>
                                          <br>
                                          <br>
                                          <b>Already have an Account?  </b>
                                          <p></p>
                                          <a class="btn btn-success btn-md" href="{%url 'login'%}" role="button">Login!</a>
                                    {% endif %}
                                  </div>
                              </div>
                            </div>
                          </div>

                </div>


  {%endblock content%}
 
  function ondownload(objs) {